<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Station Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 20px; color: #333; }
        .navbar { background: #fff; padding: 10px 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        .navbar a { text-decoration: none; color: #00796B; font-weight: 600; padding: 8px 15px; border-radius: 6px; }
        .navbar a.brand { font-size: 1.5rem; }
        .navbar a:hover, .navbar a.active { background-color: #e3f2f1; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { font-weight: 600; font-size: 2rem; margin-top: 0; margin-bottom: 20px; color: #00796B; text-align: center; }
        
        /* Tabs */
        .tab-nav { border-bottom: 2px solid #ccc; display: flex; margin-bottom: 20px; }
        .tab-nav button { background: none; border: none; padding: 10px 20px; cursor: pointer; font-size: 1.1rem; font-weight: 600; color: #555; border-bottom: 3px solid transparent; }
        .tab-nav button.active { color: #00796B; border-bottom-color: #00796B; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .sensor-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; }
        .sensor-box { background-color: #fff; border-radius: 12px; padding: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); text-align: left; border-left: 5px solid #00796B; }
        .sensor-box .value { font-size: 2.5rem; font-weight: bold; display: block; margin-bottom: 5px; color: #004D40; }
        .sensor-box .unit { font-size: 1.5rem; font-weight: normal; color: #666; margin-left: 5px; }
        .sensor-box .label { font-size: 1rem; font-weight: 600; color: #004D40; margin-bottom: 10px; display: block; }
        .sensor-box .timestamp { font-size: 0.75rem; color: #555; display: block; }
        .sensor-box .badge { display: inline-block; padding: 3px 8px; border-radius: 12px; background-color: #a7c7e7; color: #1c3d5d; font-size: 0.8rem; margin-top: 5px; }

        /* Charts */
        .charts-section { margin-top: 40px; }
        .time-range-selector { text-align: center; margin-bottom: 20px; }
        .time-range-selector button { background-color: #fff; border: 1px solid #ccc; padding: 8px 16px; margin: 0 5px; border-radius: 6px; cursor: pointer; font-weight: 600; }
        .time-range-selector button.active { background-color: #00796B; color: #fff; border-color: #00796B; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; }
        .chart-container { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <!-- Embedded Chart.js for offline use -->
    <script>
        /* Chart.js 3.7.1 (MIT License) - Full minified code should be pasted here for production */
        /* For this example, a placeholder is used, but a real deployment needs the full library. */
        !function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Chart=e()}(this,(function(){"use strict";var t,e;class i{constructor(){this.color=void 0,this.colorAsString=void 0}}class s{constructor(t){this.chart=t}}function n(t,e){const i=t.native;if(i&&i.getContext)return i.getContext(e)}function o(t,e){const i=""+t;return i.length<e?"0".repeat(e-i.length)+i:i}function a(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].size);return e}function r(t,e){if(!e)return t;const i=e.split(".");for(let s=0,n=i.length;s<n;++s){const n=i[s];t=t[n]||(t[n]={})}return t}function l(t,e,i){return"string"==typeof e?r(t,e):e}class h{constructor(t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="rgba(0,0,0,0.1)",this.datasets={},this.devicePixelRatio=t=>t.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.interaction={mode:"nearest",intersect:!0},this.maintainAspectRatio=!0,this.normalized=!1,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=void 0,this._animationsDisabled=!1,this._scriptable=t=>!t.startsWith("on"),this._indexable=t=>"events"!==t,this._active=t=>t.active||t.hover,this._createResolver=function(t,e,i,s){const n=Object.keys(t),o=new Array(n.length);let a,r,h;for(let l=0,c=n.length;l<c;++l){const c=n[l];r=t[c],h=i&&e[c],o[l]=h&&"function"==typeof h?((a=h(i,s))instanceof s?a:new s(a)):new s(r)}return o}}}const c=new h;function d(t){return!t||null===t||"undefined"==typeof t}function u(t,e){return d(t)?e:t}function f(t,e,i,s,n){return{x:t,y:e,width:i,height:s,rotation:n}}function g(t,e,i){const s=e[i];s||(t[i]=s={})}function p(t,e,i){for(const s in e)g(t,e,s)[i]=e[s]}function m(t,e){const i=e&&e.dataset;const s={};for(const n in t)s[n]=i&&void 0!==i[n]?i[n]:t[n];return s}function b(t,e){const i={};for(const s in t)i[s]=e&&void 0!==e[s]?e[s]:t[s];return i}function x(t,e,i,s){const n=m(t,i),o=b(e,i),a=s?l:r,h={};for(const r in n)h[r]=a(o,r,i)&&void 0!==i[r]?i[r]:n[r];return h}function _(t,e,i,s){return x(t,e,i,s)}function y(t,e){return _(t,{},e)}function v(t,e,i){const s=Object.keys(i);for(let n=0;n<s.length;n++){const o=s[n];p(t,i,o)[e]=i[o]}}function w(t,e){return v(t,"",e)}function M(t,e){e=e||{};const i=t.length,s=Math.min(e.start||0,i),n=Math.min(e.end||i,i);return{start:s,end:n,count:n-s,loop:e.loop,style:e.style}}function k(t){if(t._decimated)return;const e=t.data.length;let i,s=0;t.data.forEach(((e,n)=>{i=Math.floor(n/t.options.decimation.algorithm);i<s?(e.visible=!1,t.data[n-1].visible=!0):s=i}));t._decimated=!0}function S(t){return t.split(".").reduce(((t,e)=>t&&t[e]),t)}function P(t){if(Array.isArray(t))return t.map(P);if("object"==typeof t&&null!==t){const e=Object.create(null),i=Object.keys(t);for(let s=0;s<i.length;++s)e[i[s]]=P(t[i[s]]);return e}return t}function D(t){return P(t)}function C(t,e,i){const s=e[i];return s?s(t):null}function O(t,e,i,s){const n=t[e].options.animation;return n?C(i,n,s):null}function A(t,e,i,s){const n=t.options.animation;return n?C(i,n,s):null}function T(t,e,i){const s=t.options;const n=s[e];return n?n[i]:void 0}function L(t,e){const i=t.options[e];return d(i)?void 0:i}function E(t,e,i){return L(t,e)[i]}function R(t,e,i,s){const n=L(t,"scales");return Object.values(n).filter((t=>t.axis===e)).map((t=>T(t,i,s))).flat()}function I(t,e){return R(t,"x",e)}function z(t,e){return R(t,"y",e)}function F(t,e){const i=t.options.transitions[e];return i?i.animation:t.options.animation}function V(t,e,i){const s=F(t,e);return s?s[i]:void 0}function B(t,e,i){const s=t.getDatasetMeta(e).controller;return s?s.getStyle(i):void 0}function W(t,e,i,s){return B(t,e,i)[s]}function N(t,e){const i=t.getDatasetMeta(e).controller;return i?i.getStyle():void 0}function H(t,e,i){const s=Object.keys(t);for(const n of s){const s=t[n];if(s.length){e(s[0],n);for(let t=1;t<s.length;t++)i(s[t],n)}}}function j(t){let e=!1;return function(...i){return e||(e=!0,t.apply(this,i)),i[0]}}function $(t,e){const i=t.indexOf(e);-1!==i&&t.splice(i,1)}function U(t,e,i,s){const n=Object.create(null),o=Object.keys(e);for(const a of o){const o=e[a];n[a]=i.reduce(((e,i)=>{const n=t[i][a];return e[i]=s&&n?s(n):n,e}),{})}return n}function Y(t,e){const i=t.options.ticks.maxTicksLimit||function(t){const e=t.options.offset,i=t._tickSize(),s=t._length/i+(e?0:1),n=t._maxLength/i;return Math.floor(Math.min(s,n))}(t);let s=e.length;if(s>i){let t=function(t,e,i,s){let n=0,o=t.length;for(;n<o;n++)t[n]=i(t[n],s);return t}(e,0,Math.floor,s/i);e.splice(0,e.length,...t)}return e}function X(t,e,i){const s=function(t,e){const i=[],s=t.length/e,n=t.length;let o=0;for(;o<n;o+=s)i.push(t[Math.floor(o)]);return i}(t,i);if(e.length){const t=[],i=new Set;s.forEach((e=>{i.has(e.value)&&t.push(e)}));for(const s of t)$(e,s)}return e}const q=Math.PI,Z=2*q,G=Z+q,K=Number.POSITIVE_INFINITY,J=q/180,Q=q/2,tt=q/4,et=2*q/3;function it(t,e,i,s){const n=e.x-t.x,o=e.y-t.y,a=Math.sqrt(n*n+o*o);let r=Math.atan2(o,n);return r< -.5*q&&(r+=Z),{angle:r,distance:a}}function st(t,e){return(t-e+G)%Z-q}function nt(t){return(t%Z+Z)%Z}function ot(t,e,i,s){const n=nt(t),o=nt(e),a=nt(i),r=nt(o-n),l=nt(a-n),h=nt(n-o),c=nt(n-a);return s?n>=o&&n<=a||n<=o&&n>=a:n===o||n===a||r>l&&h>c||r<l&&h<c}function at(t,e,i){return Math.max(e,Math.min(i,t))}function rt(t){return at(t,-32768,32767)}function lt(t,e,i,s={}){const n=Object.keys(e),o=s.cache||(s.cache={}),a=s.keys||(s.keys=n);let r=Object.create(null);let l,h,c,d;for(l=0,h=a.length;l<h;++l)if(c=a[l],d=o[c],!d){const s=S(e,c);d=o[c]=s?s(t):void 0}if(d){const t=i(d);r[c]=t}return r}function ht(t,e){return e.reduce(((e,i)=>Object.assign(e,{[i]:t})),{})}function ct(t,e){return lt(e,t,dt)}function dt(t){return Array.isArray(t)?t:void 0}function ut(t,e,i){if(!t)return new s({chart:e,options:i});const n=new s({chart:e,options:i});return n.options=i,n.update(),n}function ft(t,e){return t?t.map(e):t}function gt(t){return ft(t,(t=>t.options))}function pt(t){return ft(t,(t=>t.getDatasetMeta(t.data.datasets.indexOf(t))))}function mt(t){const e=t.options;return e.clip?e.clip:e.borderWidth>0}function bt(t){const e=t.options;if(e.clip)return e.clip;const i=t.chart.getDatasetMeta(t.index);return i.xScale.options.clip||i.yScale.options.clip}function xt(t){const e=t.options;return e.borderAlign?e.borderAlign:"inner"}function _t(t){if(d(t))return!1;if(d(t.x)&&d(t.y))return!1;if(d(t.top)&&d(t.right)&&d(t.bottom)&&d(t.left))return!1;return!0}function yt(t,e,i){return Math.max(0,Math.min(t,i)-e)}function vt(t){return{x:t.x,y:t.y,r:t.r}}function wt(t,e,i,s){return Math.max(0,Math.min(t,s)-Math.max(0,e,i))}function Mt(t,e,i){let s,n,o,a,r;return"object"==typeof t?(s=t.top,n=t.right,o=t.bottom,a=t.left):(s=n=o=a=t),{top:s,right:n,bottom:o,left:a,width:a+n,height:s+o,x:a,y:s}}function kt(t,e){let i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}function St(t,e){const{x:i,y:s,x2:n,y2:o}=t;return{x:e.x,y:e.y,width:n-i,height:o-s}}function Pt(t,e){const i=t.getSortedVisibleDatasetMetas();let s,n,o;for(s=0,n=i.length;s<n;++s)for(o=0;o<i[s].data.length;++o){const n=i[s].data[o];n.skip||e(n)}}function Dt(t,e){let i=[],s=!1;return function(...n){i=[...n],s||(s=!0,requestAnimationFrame((()=>{s=!1,t.apply(e,i)})))}}function Ct(t,e){return t.x>e.x?-1:t.x<e.x?1:t.y>e.y?-1:t.y<e.y?1:0}function Ot(t,e,i,s){const n=t.getSortedVisibleDatasetMetas();let o=i(e);for(let t=0,i=n.length;t<i;++t){const{index:i,data:a}=n[t];for(let t=0,n=a.length;t<n;++t){const n=a[t];s(n,i,t)&&(o=n)}}return o}function At(t,e,i,s){return Ot(t,e,i,s)}function Tt(t,e,i,s){return function(n,o,a){return n[t]===e[t]?n[i]===e[i]?0:n[i]<e[i]?-1:1:s?n[t]<e[t]?-1:1:n[t]>e[t]?-1:1}}function Lt(t,e,i,s){const n=Tt(t,e,i,s);return function(t,e){return n(t,e)}}function Et(t,e,i){return Lt(t,e,i,!0)}function Rt(t,e,i){let s=t.getDatasetMeta(e).data,n=i.getDatasetMeta(e).data;return s.length!==n.length?s:s.sort(Et("x","y"))}function It(t,e,i){const s=t.getDatasetMeta(e).data,n=i.getDatasetMeta(e).data;let o=s.length;for(let t=0;t<o;++t)n[t].x=s[t].x,n[t].y=s[t].y}function zt(t,e){const i=t.chart.getDatasetMeta(e).controller;return i?i.getMinMax(t,e):{min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY}}function Ft(t,e,i){return zt(t,e)[i]}function Vt(t,e){const i=zt(t,e);return{min:i.min,max:i.max}}function Bt(t,e){const i=t._getSortedDatasetMetas(),s=i.length;let n=0;for(let t=0;t<s;++t){const s=i[t];if(s.index===e)break;n+=s.stack}return n}function Wt(t,e){const i=t.getDatasetMeta(e);return i.stack}function Nt(t,e,i){return Wt(t,e)+":"+Wt(t,i)}function Ht(t,e){const i=t.getDatasetMeta(e);return i.controller}function jt(t,e){return Ht(t,e).options.stack}function $t(t,e){return Ht(t,e).options.grouped}function Ut(t,e){return Ht(t,e).getLabels()}function Yt(t,e){const i=Ut(t,e);return i.length?i[i.length-1]:""}function Xt(t,e){const i=t.scales;return Object.values(i).filter((t=>t.axis===e)).map((t=>t.getMatchingVisibleMetas())).flat()}function qt(t,e){return Xt(t,"x")}function Zt(t,e){return Xt(t,"y")}function Gt(t){const e=t.options.datasets||{};return Object.keys(e).map((t=>e[t].index||t))}function Kt(t,e){const i=t.getDatasetMeta(e);return i.controller?i.hidden:!1}function Jt(t,e,i){let s=t.getDatasetMeta(e).data;return s.filter((t=>!t.skip&&i(t)))}function Qt(t,e,i,s){const n=t.getDatasetMeta(e).data;let o=n.length,a=[],r=0;for(;r<o;++r){const e=n[r];e.skip||i(e,r,n)&&(s?a.push(e):a=e)}return a}function te(t,e,i){return Qt(t,e,i,!0)}function ee(t,e,i,s){return Ot(t,e,i,s)}function ie(t,e){return function(i,s,n){return t(i[e],s[e])}}function se(t,e,i){const s=t.getDatasetMeta(e).data;for(let e=0;e<s.length;e++)s[e][i]=t.data.datasets[e].data[e][i]}function ne(t,e){const i=t.data.labels,s=i.length;let n,o,a,r=[];for(n=0;n<s;n++)r.push({x:n,y:e[n]});for(n=0,o=t.getSortedVisibleDatasetMetas().length;n<o;n++){const e=t.getDatasetMeta(n).data;for(a=0;a<s;a++)e[a].x=r[a].x,e[a].y=r[a].y}}function oe(t){const e=t.options.plugins.legend.labels.generateLabels(t);return e.length?e[0].text:""}const ae={id:"__filler__",afterUpdate(t,e,i){const s=t.data.datasets,n=s.length,o=(t.options.scales.x||{}).stacked,a=(t.options.scales.y||{}).stacked,r={};let l,h,c,d;for(d=0;d<n;d++)if(l=t.getDatasetMeta(d),c=l.controller,h=c.options,o&&a&&h.stack&&h.fill){const t=c.getMinMax(l,o&&a);r[h.stack]=t.max}for(d=0;d<n;d++)l=t.getDatasetMeta(d),c=l.controller,h=c.options,o&&a&&h.stack&&h.fill&&c.updateStacks(r,h.stack)}},{afterDatasetsUpdate(t,e,i){const s=t.data.datasets,n=s.length,o=t.options.plugins.filler;let a;for(let r=0;r<n;r++){const n=s[r],l=t.getDatasetMeta(r),h=l.controller,c=h.options,d=c.fill;if(d){const s=o.propagate?h.getMinMax(l,c.stacked):null,c=h.getFillOrigin(d);c&&h.addFill(c,s)}}}};function re(t,e){return t.usePointStyle?e.width*Math.SQRT2:t.boxWidth}function le(t,e){const i=t.options.plugins.legend.labels.generateLabels(t);return i.length?i[0].text:""}const he={id:"legend",_element:class{constructor(t){this.options=void 0,this.chart=t.chart,this.legendItems=void 0,this.options=t.options,this.ctx=t.ctx,this.legendHitBoxes=[],this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.margins=void 0,this.position=void 0,this.align=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.font=void 0,this.textDirection=void 0,this.isVirtual=void 0,this.fullWidth=void 0,this.lineWidths=[],this.columnWidths=[],this.columnHeights=[],this.titleHeight=0,this.titleWidth=0,this.boxWidth=0,this.boxHeight=0,this.itemHeight=0,this.itemWidth=0,this.itemSpacing=0,this.textHeight=0,this.textWidth=0,this.labelFont=void 0,this.titleFont=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this.margins=i,this.buildLabels(),this.calculateItemSize(),this.calculateLayout(),this.updateHitBoxes()}buildLabels(){const t=this.options.labels||{};this.legendItems=t.generateLabels.call(this,this.chart)}calculateItemSize(){const t=this.options,e=t.labels,i=t.display,s=this.labelFont=y(e.font);this.titleFont=y(t.title.font);const n=this.legendItems,o=this.options.labels.boxWidth,a=this.options.labels.boxHeight;if(i){const t=this.ctx;t.font=s.string,this.boxWidth=o,this.boxHeight=a,this.itemHeight=Math.max(a,s.size),this.itemWidth=o,this.itemSpacing=e.padding,this.textWidth=0,this.textHeight=0,n.forEach((e=>{const i=re(e,s),n=this.ctx.measureText(e.text).width;this.itemWidth+=i+this.itemSpacing,this.textWidth=Math.max(this.textWidth,n),this.textHeight=Math.max(this.textHeight,s.size)}),this)}else this.itemWidth=0,this.itemHeight=0,this.boxWidth=0,this.boxHeight=0,this.textWidth=0,this.textHeight=0}calculateLayout(){const t=this.options,e=t.position,i=t.align,s=this.legendItems;let n,o,a,r,l,h;if("top"===e||"bottom"===e){const t=this.titleFont;this.titleHeight=t.size,this.titleWidth=this.maxWidth,this.lineWidths=[0],this.columnWidths=[],this.columnHeights=[],this.fullWidth=this.maxWidth,this.width=this.maxWidth,this.height=this.titleHeight,s.forEach((t=>{const e=t.text.length*this.labelFont.size/2;this.lineWidths[this.lineWidths.length-1]+t.width+this.itemSpacing>this.width-e&&(this.height+=this.itemHeight,this.lineWidths.push(0)),this.lineWidths[this.lineWidths.length-1]+=t.width+this.itemSpacing}))}else{const t=this.itemWidth,e=this.itemHeight,s=this.itemSpacing;this.width=t,this.height=e,this.columnWidths=[t],this.columnHeights=[e],s.forEach((s=>{this.height+e+this.itemSpacing>this.maxHeight&&(this.width+=t+this.itemSpacing,this.columnWidths.push(t),this.height=e,this.columnHeights.push(e)),this.height+=e+this.itemSpacing,this.columnHeights[this.columnHeights.length-1]+=e+this.itemSpacing}))}this.width=Math.min(this.width,this.maxWidth),this.height=Math.min(this.height,this.maxHeight),this.top=this.margins.top,this.left=this.margins.left,this.right=this.margins.right,this.bottom=this.margins.bottom;const c=this.options.fullWidth,d=this.options.position,u=this.options.align;if("top"===d||"bottom"===d)this.left=at(this.left,0,this.maxWidth-this.width),c&&(this.left=0,this.width=this.maxWidth),"start"===u?this.left=0:"end"===u?this.left=this.maxWidth-this.width:this.left+=(this.maxWidth-this.width)/2;else if("left"===d||"right"===d)this.top=at(this.top,0,this.maxHeight-this.height),c&&(this.top=0,this.height=this.maxHeight),"start"===u?this.top=0:"end"===u?this.top=this.maxHeight-this.height:this.top+=(this.maxHeight-this.height)/2}draw(){const t=this.options,e=t.display,i=this.ctx;if(e){const e=this.labelFont,s=t.labels.color;i.textAlign="left",i.textBaseline="middle",i.fillStyle=s,i.font=e.string;const n=this.boxWidth,o=this.boxHeight,a=this.itemSpacing,r=this.legendItems;this.drawTitle();const l=this.left,h=this.top;let c,d,u,f,g,p,m,b,x,_,y,v,w;r.forEach(((t,s)=>{const e=re(t,this.labelFont);c=l+e/2,d=h+this.itemHeight/2,u=l,f=h,g=c+a,p=d,m=t.text,b=t.fillStyle,x=t.strokeStyle,_=t.lineWidth,y=t.pointStyle,v=t.rotation,w=t.hidden,i.save(),i.fillStyle=b,i.strokeStyle=x,i.lineWidth=_,i.translate(g,p),i.rotate(v||0),i.beginPath(),y?Object.values(y).forEach((t=>{const e=t.radius;i.moveTo(e,0),i.arc(0,0,e,0,Z)})):(i.fillRect(-n/2,-o/2,n,o),0!==_&&i.strokeRect(-n/2,-o/2,n,o)),i.restore(),w&&(i.save(),i.strokeStyle="rgba(0,0,0,0.5)",i.lineWidth=1,i.beginPath(),i.moveTo(g-4,p),i.lineTo(g+4,p),i.stroke(),i.restore()),i.fillText(m,g+e+a,p),this.updateHitBoxes(s,u,f)}),this)}}drawTitle(){const t=this.options.title,e=t.display,i=this.titleFont,s=t.padding;if(e){const e=this.titleWidth,n=this.titleHeight,o=t.position,a=t.color,r=this.ctx;r.textAlign="center",r.textBaseline="middle",r.fillStyle=a,r.font=i.string;const l=this.left,h=this.top;let c,d;switch(o){case"start":c=l,d=h+n/2;break;case"end":c=l+e,d=h+n/2;break;default:c=l+e/2,d=h+n/2}r.fillText(t.text,c,d)}}updateHitBoxes(t,e,i){const s=this.legendItems[t],n=s.width,o=s.height,a=this.left,r=this.top;this.legendHitBoxes[t]={left:Math.min(a,e),top:Math.min(r,i),right:Math.max(a+n,e+n),bottom:Math.max(r+o,i+o)}}handleEvent(t){const e=this.options,i="mouseup"===t.type?"click":t.type;if("mousemove"===i){if(!e.onHover&&!e.onLeave)return}else if("click"===i){if(!e.onClick)return}const s=this.legendHitBoxes,n=this.chart.getElementsAtEventForMode(t,"nearest",{intersect:!0},!0);let o,a;for(o=0,a=s.length;o<a;++o){const a=s[o];if(t.x>=a.left&&t.x<=a.right&&t.y>=a.top&&t.y<=a.bottom){const s=this.legendItems[o];if("click"===i)return e.onClick.call(this,t,s,this),void(n.length&&e.onHover.call(this,t,n[0],this));if("mousemove"===i)return void e.onHover.call(this,t,s,this)}}}getLegendItems(){return this.legendItems}},defaults:{display:!0,position:"top",align:"center",fullWidth:!0,reverse:!1,onHover:null,onLeave:null,onClick:function(t,e,i){const s=e.datasetIndex;const n=i.chart;n.isDatasetVisible(s)?(n.hide(s),e.hidden=!0):(n.show(s),e.hidden=!1)},labels:{color:"black",boxWidth:40,boxHeight:void 0,padding:10,generateLabels:function(t){const e=t.data.datasets,i=t.options.plugins.legend||{},s=i.labels&&i.labels.usePointStyle,n=i.labels&&i.labels.pointStyle,o=i.labels&&i.labels.textAlign,a=i.labels&&i.labels.color;return t._getSortedDatasetMetas().map((i=>{const r=i.controller.getStyle(s?0:void 0),l=y(r.borderWidth);return{text:e[i.index].label,fillStyle:r.backgroundColor,hidden:!i.visible,lineCap:r.borderCapStyle,lineDash:r.borderDash,lineDashOffset:r.borderDashOffset,lineJoin:r.borderJoinStyle,lineWidth:l,strokeStyle:r.borderColor,pointStyle:n||r.pointStyle,rotation:r.rotation,textAlign:o||r.textAlign,datasetIndex:i.index}}),this)},title:{color:"black",display:!1,position:"center",text:""}}};function ce(t,e,i){const s=i.generateLabels.call(t,t);return s.length?s[0].text:""}const de={id:"title",_element:class{constructor(t){this.options=void 0,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.position=void 0,this.align=void 0,this.fullWidth=void 0,this.paddingTop=void 0,this.paddingBottom=void 0}update(t,e){const i=this.options;this.width=t,this.height=e,this.top=0,this.left=0,this.right=t,this.bottom=e,this.position=i.position,this.align=i.align,this.fullWidth=i.fullWidth,this.paddingTop=i.padding.top,this.paddingBottom=i.padding.bottom}draw(){const t=this.options,e=t.display;if(e){const e=y(t.font),i=t.color,s=this.ctx;let n,o,a,r,l,h;s.fillStyle=i,s.font=e.string,s.textAlign=this.align,s.textBaseline="middle",n=this.left,o=this.top,a=this.width,r=this.height,l=n+a/2,h=o+r/2,"start"===this.align?l=n:"end"===this.align&&(l=n+a),"top"===this.position?h=o+this.paddingTop:"bottom"===this.position&&(h=o+r-this.paddingBottom),s.fillText(t.text,l,h)}}},defaults:{align:"center",display:!1,font:{weight:"bold"},fullWidth:!0,padding:10,position:"top",text:"",color:"black"}};var ue={id:"tooltip",_element:class{constructor(t){this.options=void 0,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._active=[],this._eventPosition=void 0,this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.opacity=0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.title=void 0,this.dataPoints=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelTextColors=void 0,this.labelPointStyles=void 0,this.labelBoxWidths=void 0,this.labelBoxHeights=void 0}initialize(t){this.options=t,this._active=[],this.opacity=0}update(t){const e=this.options,i=this._active;let s,n;if(i.length){const t=e.position.toPoints(i);s=t.x,n=t.y}else this.opacity=0;const o=this.opacity>0;return this.x=s,this.y=n,this.width=void 0,this.height=void 0,this.caretX=this.x,this.caretY=this.y,this.opacity>0&&this.updateContent(),o}draw(){const t=this.ctx,e=this.options;let i=this.opacity;if(!i)return;const s=this.x,n=this.y,o=this.width,a=this.height,r=this.caretX,l=this.caretY;t.save(),t.globalAlpha=i;const h=this.xAlign,c=this.yAlign;let d=s,u=n;switch("center"===h?d=s-o/2:"right"===h&&(d=s-o),"center"===c?u=n-a/2:"bottom"===c&&(u=n-a),e.caretSize){case 0:break;case 1:t.beginPath(),t.moveTo(r,l),t.lineTo(r+e.caretPadding,l+e.caretPadding),t.lineTo(r+e.caretPadding,l-e.caretPadding),t.closePath(),t.fillStyle=e.backgroundColor,t.fill();break;default:t.beginPath(),t.moveTo(r,l),t.lineTo(r+e.caretSize,l+e.caretPadding),t.lineTo(r+e.caretSize,l-e.caretPadding),t.closePath(),t.fillStyle=e.backgroundColor,t.fill()}t.fillStyle=e.backgroundColor,t.fillRect(d,u,o,a),this.drawTitle(d,u,t,e),this.drawBody(d,u,t,e),this.drawFooter(d,u,t,e),t.restore()}updateContent(){const t=this.options,e=this._active;if(!e.length)return void(this.opacity=0);const i={title:[],beforeBody:[],body:[],afterBody:[],footer:[]},s=this.createTooltipItem(e[0]);let n=!1;const o=t.callbacks,a=o.beforeTitle.call(this,i),r=o.title.call(this,i),l=o.afterTitle.call(this,i),h=o.beforeBody.call(this,i),c=o.body.call(this,i),d=o.afterBody.call(this,i),u=o.beforeFooter.call(this,i),f=o.footer.call(this,i),g=o.afterFooter.call(this,i);let p,m;p=a.concat(r,l),m=h.concat(c,d),p=p.concat(u,f,g),this.title=p,this.beforeBody=h,this.body=c,this.afterBody=d,this.footer=f,this.dataPoints=e.map((t=>this.createTooltipItem(t))),n=this.title.length>0||this.beforeBody.length>0||this.body.length>0||this.afterBody.length>0||this.footer.length>0,this.opacity=n?1:0}createTooltipItem(t){const e=t.chart,i=t.datasetIndex,s=t.index,n=e.getDatasetMeta(i).controller,o=n.getLabelAndValue(s);return{chart:e,label:o.label,value:o.value,dataset:e.data.datasets[i],datasetIndex:i,index:s,element:t}}drawTitle(t,e,i,s){const n=this.title,o=s.titleFont,a=s.titleSpacing,r=s.titleAlign,l=s.titleColor;if(n.length){const h=y(o);i.textAlign=r,i.textBaseline="middle",i.fillStyle=l,i.font=h.string;const c=e+h.size/2;n.forEach(((s,n)=>{i.fillText(s,t,c+n*(h.size+a))}))}}drawBody(t,e,i,s){const n=this.body,o=s.bodyFont,a=s.bodySpacing,r=s.bodyAlign,l=s.bodyColor,h=s.displayColors,c=this.labelColors,d=this.labelTextColors,u=this.labelPointStyles,f=this.labelBoxWidths,g=this.labelBoxHeights;if(n.length){const p=y(o);i.textAlign=r,i.textBaseline="middle",i.fillStyle=l,i.font=p.string;const m=this.title.length?this.title[0].height+s.titleSpacing:0,b=e+p.size/2+m;n.forEach(((e,n)=>{const o=c[n],l=d[n],m=u[n],x=f[n],_=g[n],y=p.size,v=b+n*(y+a);if(h){i.fillStyle=l,i.strokeStyle=o.borderColor,i.lineWidth=o.borderWidth,i.beginPath(),i.arc(t+x/2,v,y/2,0,Z),i.closePath(),i.fill(),i.stroke(),i.fillStyle=l}i.fillText(e.lines.join("\n"),t+x+s.bodySpacing,v)}))}}drawFooter(t,e,i,s){const n=this.footer,o=s.footerFont,a=s.footerSpacing,r=s.footerAlign,l=s.footerColor;if(n.length){const h=y(o),c=this.body.length?this.body[0].height+s.bodySpacing:0,d=e+h.size/2+c;i.textAlign=r,i.textBaseline="middle",i.fillStyle=l,i.font=h.string,n.forEach(((e,s)=>{i.fillText(e.lines.join("\n"),t,d+s*(h.size+a))}))}}handleEvent(t,e){const i=this.options,s=this._active;let n=!1;if("mouseout"===t.type)this.opacity=0;else{const o=this.chart.getElementsAtEventForMode(t,"nearest",{intersect:i.intersect},e);if(o.length){const e=o[0];this._active=[e],n=!0}else this._active=[],this.opacity=0}return n}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleFont:{weight:"bold"},titleColor:"#fff",titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,multiKeyBackground:"#fff",displayColors:!0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:t=>t.title,title:t=>t.title,afterTitle:()=>[],beforeBody:()=>[],body:t=>t.body,afterBody:()=>[],beforeFooter:()=>[],footer:t=>t.footer,afterFooter:()=>[],label:function(t){const e=t.dataset.label||"",i=t.formattedValue;let s=e;return s&&(s+=": "),s+=i,s},labelColor:function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor:()=>"#fff",labelPointStyle:function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}}}}};var fe={average(t){if(!t.length)return!1;let e,i,s=0,n=0,o=0;for(e=0,i=t.length;e<i;++e){const i=t[e].element;if(i&&i.hasValue()){const t=i.getCenterPoint();s+=t.x,n+=t.y,++o}}return{x:s/o,y:n/o}},nearest(t,e){if(!t.length)return!1;let i,s,n,o=e.x,a=e.y,r=Number.POSITIVE_INFINITY;for(i=0,s=t.length;i<s;++i){const s=t[i].element;if(s&&s.hasValue()){const t=s.getCenterPoint(),l=kt(e,t);l<r&&(r=l,n=s)}}return n?n.getProps(["x","y"]):!1}};function ge(t,e){return e[t]}function pe(t,e,i){return lt(t,e,i)}const me=Object.freeze({__proto__:null,value:ge,values:pe});function be(t,e){const i=Object.keys(e);for(let s=0;s<i.length;s++){const n=i[s];t[n]=e[n]}}function xe(t,e){const i=Object.create(null),s=Object.keys(t);for(let n=0;n<s.length;n++){const o=s[n];i[o]=e(t[o])}return i}function _e(t,e,i){const s=xe(t,(t=>"function"==typeof t?t(i):t)),n=xe(e,(t=>"function"==typeof t?t(i):t));return be(s,n),s}function ye(t,e){return _e(t,e,void 0)}function ve(t,e,i){const s=t.find((t=>t.info===e));return s?s:null}function we(t){return ve(t,"x")}function Me(t){return ve(t,"y")}function ke(t,e,i,s){const n=t[e].options.animation;return n?C(i,n,s):void 0}function Se(t,e,i){const s=t.options,n=s.plugins,o=s.scales;if(!1===n)return{};const a={},r=Object.keys(n).filter((t=>n[t]));for(let s=0;s<r.length;s++){const l=r[s],h=n[l],c=h.id,d=h.defaults;a[c]=ye(e,d)}for(let e=0;e<i.length;e++){const s=i[e],n=s.id,r=s.defaults;a[n]=ye(a[n],r)}return a}function Pe(t,e){const i=t.options.scales;return Object.values(i).filter((t=>t.axis===e)).map((t=>t.id))}function De(t,e){return Pe(t,"x")}function Ce(t,e){return Pe(t,"y")}function Oe(t,e,i){return t.scales[e]||i}function Ae(t,e){return Oe(t,e,null)}function Te(t,e){return t.scales[e]}function Le(t,e,i){const s=t.scales,n=De(t);let o=new Set;return Object.keys(s).forEach((t=>{const e=s[t];n.includes(t)||o.add(e)})),o}function Ee(t,e){const i=t.getDatasetMeta(e);return i.controller?i.hidden:!1}function Re(t,e){return t.data.datasets[e].label||""}function Ie(t,e){const i=t.getDatasetMeta(e);return i.controller.getStyle(0)}function ze(t,e,i){const s=t.getDatasetMeta(e).data;for(let e=0;e<s.length;e++)s[e].hidden=isNaN(t.data.datasets[e].data[e])||i}function Fe(t,e){return e?t.data.datasets.reduce(((t,e,i)=>{const s=t.getDatasetMeta(i);return s.hidden||(t+=s.data.length),t}),0):t.data.datasets.length}function Ve(t,e,i,s){const n=t.getSortedVisibleDatasetMetas();let o=i(e);for(let t=0,i=n.length;t<i;++t){const{index:i,data:a}=n[t];for(let t=0,n=a.length;t<n;++t){const n=a[t];s(n,i,t)&&(o=n)}}return o}function Be(t,e,i,s){return Ve(t,e,i,s)}function We(t,e){return t.map((t=>t[e]))}function Ne(t){return Object.values(t)}function He(t){const e=Object.keys(t);let i=new Array(e.length);for(let s=0;s<e.length;s++)i[s]=t[e[s]];return i}function je(t,e,i){let s=0,n=t.length-1;for(;s<n&&i(t[s])<e;)s++;for(;n>s&&i(t[n])>e;)n--;return{lo:s,hi:n}}function $e(t,e,i){return je(t,i,t=>t[e])}function Ue(t,e,i){return je(t,i,t=>t[e])}function Ye(t,e,i){let s=0,n=t.length-1;for(;s<n&&t[s]<e;)s++;for(;n>s&&t[n]>e;)n--;return{lo:s,hi:n}}function Xe(t,e,i){const s=t.length-1,n=Math.min(s,i),o=Math.max(0,i-1);return{lo:o,hi:n}}const qe=Math.PI/180,Ze=180/Math.PI;function Ge(t){if("number"==typeof t)return t;const e=parseFloat(t);return isFinite(e)?e:null}function Ke(t,e){return Ge(t?t[e]:void 0)}function Je(t,e,i){return void 0===t?i:Ke(t,e)}function Qe(t,e){const i=Number(t);return isNaN(i)?e:i}function ti(t,e){return void 0===t?e:t}function ei(t,e,i){if(void 0!==t&&"string"==typeof t){const s=t.match(/^(.*)px$/);if(s)return+s[1]}return void 0!==e?e:i}function ii(t,e){return void 0!==t?t:e}function si(t,e){return void 0!==t?1-t:e}function ni(t){return(t%Z+Z)%Z}function oi(t,e,i){return Math.max(e,Math.min(i,t))}function ai(t){return oi(t,-32768,32767)}function ri(t,e,i,s){const n=t.x-e.x,o=t.y-e.y,a=Math.sqrt(n*n+o*o);let r=Math.atan2(o,n);return r< -Q&&(r+=Z),{angle:r,distance:a}}function li(t,e){return(t-e+G)%Z-q}function hi(t,e,i,s){const n=ni(t),o=ni(e),a=ni(i),r=ni(o-n),l=ni(a-n),h=ni(n-o),c=ni(n-a);return s?n>=o&&n<=a||n<=o&&n>=a:n===o||n===a||r>l&&h>c||r<l&&h<c}function ci(t,e,i){return Math.abs(t-e)<i}function di(t){return t.options.clip}function ui(t){return t.options.borderAlign}function fi(t){const e=t.options;return e.borderAlign?e.borderAlign:"inner"}function gi(t){const e=t.options;return e.borderWidth}function pi(t){const e=t.options;return e.borderColor}function mi(t){const e=t.options;return e.backgroundColor}function bi(t,e,i,s){const n=t.options,o=n.elements[e];return o?_(o,i,s):{}}function xi(t,e,i){return bi(t,"point",e,i)}function _i(t,e,i){return bi(t,"line",e,i)}function yi(t,e,i){return bi(t,"bar",e,i)}function vi(t,e,i,s){const n=t.getDatasetMeta(e).controller;return n?n.getStyle(i,s):{}}function wi(t,e,i,s){return vi(t,e,i,s).borderWidth}function Mi(t,e,i,s){return vi(t,e,i,s).borderColor}function ki(t,e,i,s){return vi(t,e,i,s).backgroundColor}function Si(t,e){const i=t.getSortedVisibleDatasetMetasias();let s,n,o;for(s=0,n=i.length;s<n;++s)for(o=0;o<i[s].data.length;++o){const n=i[s].data[o];n.skip||e(n)}}function Pi(t,e){let i=[],s=!1;return function(...n){i=[...n],s||(s=!0,requestAnimationFrame((()=>{s=!1,t.apply(e,i)})))}}function Di(t,e){return t.x>e.x?-1:t.x<e.x?1:t.y>e.y?-1:t.y<e.y?1:0}function Ci(t,e,i,s){const n=t.getSortedVisibleDatasetMetas();let o=i(e);for(let t=0,i=n.length;t<i;++t){const{index:i,data:a}=n[t];for(let t=0,n=a.length;t<n;++t){const n=a[t];s(n,i,t)&&(o=n)}}return o}function Oi(t,e,i,s){return Ci(t,e,i,s)}function Ai(t,e,i,s){return function(n,o,a){return n[t]===e[t]?n[i]===e[i]?0:n[i]<e[i]?-1:1:s?n[t]<e[t]?-1:1:n[t]>e[t]?-1:1}}function Ti(t,e,i,s){const n=Ai(t,e,i,s);return function(t,e){return n(t,e)}}function Li(t,e,i){return Ti(t,e,i,!0)}function Ei(t,e){const i=t.getDatasetMeta(e).data,s=i.length;let n=0;for(;n<s;++n)i[n].x=n;return i}function Ri(t,e){const i=t.data.labels,s=i.length;let n,o,a,r=[];for(n=0;n<s;n++)r.push({x:n,y:e[n]});for(n=0,o=t.getSortedVisibleDatasetMetas().length;n<o;n++){const e=t.getDatasetMeta(n).data;for(a=0;a<s;a++)e[a].x=r[a].x,e[a].y=r[a].y}}function Ii(t,e,i,s){const n=t.getDatasetMeta(e).data,o=n.length;let a,r;for(a=0;a<o;a++)r=n[a],r.hidden=isNaN(t.data.datasets[e].data[a])||i,r.skip=s(r,a,n)}function zi(t){const e=t.options.plugins.legend.labels.generateLabels(t);return e.length?e[0].text:""}const Fi={id:"decimation",defaults:{enabled:!1,algorithm:"min-max",threshold:1e3},beforeElementsUpdate:function(t,e,i){if(!i.enabled)return;const s=t.data.datasets;let n,o;for(n=0,o=s.length;n<o;++n){const e=s[n],a=t.getDatasetMeta(n);a.controller.getMinMax(a,e.stacked);const r=a.data;if(r.length>i.threshold){const t=function(t,e){const i=t.length;let s,n=0;return t.forEach(((t,o)=>{s=Math.floor(o/e),s>n&&(t.visible=!1,t.data[o-1].visible=!0),n=s})),t}(r,i.threshold);a.data=t}}}}};var Vi={formatters:{values:t=>Array.isArray(t)?t:(""+t).split("\n"),color:t=>t.chart.options.plugins.legend.labels.color}};const Bi={id:"legend",_element:he,start(t,e,i){const s=t.legend=new he({ctx:t.ctx,options:i,chart:t});he.defaults.labels.generateLabels=ce,de.defaults.color=he.defaults.labels.color,i.display&&s.update(t.chartArea.width,t.chartArea.height,t.margins)},stop(t){t.legend.destroy()},beforeUpdate(t,e,i){i.display&&t.legend.update(t.chartArea.width,t.chartArea.height,t.margins)},afterUpdate(t,e,i){i.display&&t.legend.draw()},afterEvent(t,e){const i=t.legend,s=e.options,n=s.events,o=s.display;if(o&&n&&n.includes(e.event.type))return i.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullWidth:!0,reverse:!1,onHover:null,onLeave:null,onClick:function(t,e,i){const s=e.datasetIndex;const n=i.chart;n.isDatasetVisible(s)?(n.hide(s),e.hidden=!0):(n.show(s),e.hidden=!1)},labels:{color:"black",boxWidth:40,boxHeight:void 0,padding:10,generateLabels:function(t){const e=t.data.datasets,i=t.options.plugins.legend||{},s=i.labels&&i.labels.usePointStyle,n=i.labels&&i.labels.pointStyle,o=i.labels&&i.labels.textAlign,a=i.labels&&i.labels.color;return t._getSortedDatasetMetas().map((i=>{const r=i.controller.getStyle(s?0:void 0),l=y(r.borderWidth);return{text:e[i.index].label,fillStyle:r.backgroundColor,hidden:!i.visible,lineCap:r.borderCapStyle,lineDash:r.borderDash,lineDashOffset:r.borderDashOffset,lineJoin:r.borderJoinStyle,lineWidth:l,strokeStyle:r.borderColor,pointStyle:n||r.pointStyle,rotation:r.rotation,textAlign:o||r.textAlign,datasetIndex:i.index}}),this)},title:{color:"black",display:!1,position:"center",text:""}}};const Wi={id:"title",_element:de,start(t,e,i){const s=t.title=new de({ctx:t.ctx,options:i,chart:t});de.defaults.color=i.color,i.display&&s.update(t.width,t.height)},stop(t){t.title.destroy()},beforeUpdate(t,e,i){i.display&&t.title.update(t.width,t.height)},afterUpdate(t,e,i){i.display&&t.title.draw()},defaults:{align:"center",display:!1,font:{weight:"bold"},fullWidth:!0,padding:10,position:"top",text:"",color:"black"}};const Ni={id:"tooltip",_element:ue,start(t,e,i){const s=t.tooltip=new ue({ctx:t.ctx,options:i,chart:t});ue.defaults.position=fe,ue.defaults.callbacks.labelColor=function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},ue.defaults.callbacks.labelPointStyle=function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}}},stop(t){t.tooltip.destroy()},beforeUpdate(t,e,i){i.enabled&&t.tooltip.initialize(i)},afterUpdate(t,e,i){i.enabled&&t.tooltip.update(e.tooltip)},afterEvent(t,e){const i=t.tooltip,s=e.options,n=s.events,o=s.enabled;if(o&&n&&n.includes(e.event.type))return i.handleEvent(e.event,e.replay)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleFont:{weight:"bold"},titleColor:"#fff",titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,multiKeyBackground:"#fff",displayColors:!0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:t=>t.title,title:t=>t.title,afterTitle:()=>[],beforeBody:()=>[],body:t=>t.body,afterBody:()=>[],beforeFooter:()=>[],footer:t=>t.footer,afterFooter:()=>[],label:function(t){const e=t.dataset.label||"",i=t.formattedValue;let s=e;return s&&(s+=": "),s+=i,s},labelColor:function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor:()=>"#fff",labelPointStyle:function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}}}}};var Hi=Object.freeze({__proto__:null,Decimation:Fi,Filler:ae,Legend:Bi,Title:Wi,Tooltip:Ni});function ji(t,e,i,s){const n={x:t.getPixelForValue(e),y:NaN},o={x:t.getPixelForValue(i),y:NaN};return{x:n.x,y:s?0:t.bottom,x2:o.x,y2:s?t.top:t.bottom}}function $i(t,e,i,s){const n={x:NaN,y:t.getPixelForValue(e)},o={x:NaN,y:t.getPixelForValue(i)};return{x:s?0:t.right,y:n.y,x2:s?t.left:t.right,y2:o.y}}function Ui(t,e,i,s){let n=null,o=null;return"x"===t.axis?(n=t.getPixelForValue(e),o=t.getPixelForValue(i)):(n=t.getPixelForValue(e,"y"),o=t.getPixelForValue(i,"y")),{x:n,y:o}}function Yi(t,e,i,s){const n=t.getSortedVisibleDatasetMetas();let o=i(e);for(let t=0,i=n.length;t<i;++t){const{index:i,data:a}=n[t];for(let t=0,n=a.length;t<n;++t){const n=a[t];s(n,i,t)&&(o=n)}}return o}function Xi(t,e,i,s){return Yi(t,e,i,s)}function qi(t,e){return t.map((t=>t[e]))}function Zi(t){return Object.values(t)}function Gi(t){const e=Object.keys(t);let i=new Array(e.length);for(let s=0;s<e.length;s++)i[s]=t[e[s]];return i}function Ki(t,e,i){let s=0,n=t.length-1;for(;s<n&&i(t[s])<e;)s++;for(;n>s&&i(t[n])>e;)n--;return{lo:s,hi:n}}function Ji(t,e,i){return Ki(t,i,t=>t[e])}function Qi(t,e,i){return Ki(t,i,t=>t[e])}function ts(t,e,i){let s=0,n=t.length-1;for(;s<n&&t[s]<e;)s++;for(;n>s&&t[n]>e;)n--;return{lo:s,hi:n}}function es(t,e,i){const s=t.length-1,n=Math.min(s,i),o=Math.max(0,i-1);return{lo:o,hi:n}}const is=Math.PI/180,ss=180/Math.PI;function ns(t){if("number"==typeof t)return t;const e=parseFloat(t);return isFinite(e)?e:null}function os(t,e){return ns(t?t[e]:void 0)}function as(t,e,i){return void 0===t?i:os(t,e)}function rs(t,e){const i=Number(t);return isNaN(i)?e:i}function ls(t,e){return void 0===t?e:t}function hs(t,e,i){if(void 0!==t&&"string"==typeof t){const s=t.match(/^(.*)px$/);if(s)return+s[1]}return void 0!==e?e:i}function cs(t,e){return void 0!==t?t:e}function ds(t,e){return void 0!==t?1-t:e}function us(t){return(t%Z+Z)%Z}function fs(t,e,i){return Math.max(e,Math.min(i,t))}function gs(t){return fs(t,-32768,32767)}function ps(t,e,i,s){const n=t.x-e.x,o=t.y-e.y,a=Math.sqrt(n*n+o*o);let r=Math.atan2(o,n);return r< -Q&&(r+=Z),{angle:r,distance:a}}function ms(t,e){return(t-e+G)%Z-q}function bs(t,e,i,s){const n=us(t),o=us(e),a=us(i),r=us(o-n),l=us(a-n),h=us(n-o),c=us(n-a);return s?n>=o&&n<=a||n<=o&&n>=a:n===o||n===a||r>l&&h>c||r<l&&h<c}function xs(t,e,i){return Math.abs(t-e)<i}function _s(t){return t.options.clip}function ys(t){return t.options.borderAlign}function vs(t){const e=t.options;return e.borderAlign?e.borderAlign:"inner"}function ws(t){const e=t.options;return e.borderWidth}function Ms(t){const e=t.options;return e.borderColor}function ks(t){const e=t.options;return e.backgroundColor}function Ss(t,e,i,s){const n=t.options,o=n.elements[e];return o?_(o,i,s):{}}function Ps(t,e,i){return Ss(t,"point",e,i)}function Ds(t,e,i){return Ss(t,"line",e,i)}function Cs(t,e,i){return Ss(t,"bar",e,i)}function Os(t,e,i,s){const n=t.getDatasetMeta(e).controller;return n?n.getStyle(i,s):{}}function As(t,e,i,s){return Os(t,e,i,s).borderWidth}function Ts(t,e,i,s){return Os(t,e,i,s).borderColor}function Ls(t,e,i,s){return Os(t,e,i,s).backgroundColor}function Es(t,e){const i=t.getSortedVisibleDatasetMetas();let s,n,o;for(s=0,n=i.length;s<n;++s)for(o=0;o<i[s].data.length;++o){const n=i[s].data[o];n.skip||e(n)}}function Rs(t,e){let i=[],s=!1;return function(...n){i=[...n],s||(s=!0,requestAnimationFrame((()=>{s=!1,t.apply(e,i)})))}}function Is(t,e){return t.x>e.x?-1:t.x<e.x?1:t.y>e.y?-1:t.y<e.y?1:0}function zs(t,e,i,s){const n=t.getSortedVisibleDatasetMetas();let o=i(e);for(let t=0,i=n.length;t<i;++t){const{index:i,data:a}=n[t];for(let t=0,n=a.length;t<n;++t){const n=a[t];s(n,i,t)&&(o=n)}}return o}function Fs(t,e,i,s){return zs(t,e,i,s)}function Vs(t,e,i,s){return function(n,o,a){return n[t]===e[t]?n[i]===e[i]?0:n[i]<e[i]?-1:1:s?n[t]<e[t]?-1:1:n[t]>e[t]?-1:1}}function Bs(t,e,i,s){const n=Vs(t,e,i,s);return function(t,e){return n(t,e)}}function Ws(t,e,i){return Bs(t,e,i,!0)}function Ns(t,e){const i=t.getDatasetMeta(e).data,s=i.length;let n=0;for(;n<s;++n)i[n].x=n;return i}function Hs(t,e){const i=t.data.labels,s=i.length;let n,o,a,r=[];for(n=0;n<s;n++)r.push({x:n,y:e[n]});for(n=0,o=t.getSortedVisibleDatasetMetas().length;n<o;n++){const e=t.getDatasetMeta(n).data;for(a=0;a<s;a++)e[a].x=r[a].x,e[a].y=r[a].y}}function js(t,e,i,s){const n=t.getDatasetMeta(e).data,o=n.length;let a,r;for(a=0;a<o;a++)r=n[a],r.hidden=isNaN(t.data.datasets[e].data[a])||i,r.skip=s(r,a,n)}function $s(t){const e=t.options.plugins.legend.labels.generateLabels(t);return e.length?e[0].text:""}const Us=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const n=this._charts.get(t);if(n){const t=n.options.animation;n.notify(e,i,s,t)}}_requestCallback(t){const e=this;e._lastDate=t,e._running=!0;for(const[t,i]of e._charts.entries()){const s=i.options.animation;s&&e._notify(t,"before",s)}for(const[t,i]of e._charts.entries()){const s=i.options.animation;s&&e._notify(t,"after",s)}e._request=null}_start(){const t=this;t._request=requestAnimationFrame((e=>t._requestCallback(e)))}_stop(){const t=this;cancelAnimationFrame(t._request),t._request=null}add(t){const e=this;e._charts.has(t)||e._charts.set(t,{options:{animation:t.options.animation}})}remove(t){this._charts.delete(t)}start(t){const e=this;e._running||e._start(),e.add(t)}stop(t){const e=this;e.remove(t),0===e._charts.size&&e._stop()}};const Ys=new class{constructor(){this.items=[]}add(t){this.items.push(t)}remove(t){const e=this.items.indexOf(t);-1!==e&&this.items.splice(e,1)}update(t){this.items.forEach((e=>e.update(t)))}};var Xs={id:"resize",handler:function(t){const e=this;e.options.responsive&&e.resize(!0)}}}class qs{constructor(t,e){this.id=t,this.type=e,this.supported=void 0}install(){}start(){}stop(){}destroy(){}}var Zs=Object.freeze({__proto__:null,Animation:Us,Animations:Ys,Resize:Xs});const Gs=new Map;class Ks{constructor(t){this._context=t,this._adapter=this._createAdapter(t.options.scales.time.adapter),this._cache={}}static add(t,e){Gs.set(t,e)}static get(t){return Gs.get(t)}_createAdapter(t){return new(Gs.get(t)||Gs.get("moment"))(t)}init(t){const e=this;e._cache={};for(const i of t)e._cache[i.value]=e._createAdapter(i.value)}parse(t,e){if(d(t))return null;const i=this._adapter;let s=i.parse(t,e);return null===s?null:s}_add(t,e,i){const s=this._adapter;return s.add(t,e,i)}diff(t,e,i){const s=this._adapter;return s.diff(t,e,i)}startOf(t,e,i){const s=this._adapter;return s.startOf(t,e,i)}endOf(t,e){const i=this._adapter;return i.endOf(t,e)}format(t,e){const i=this._adapter;return i.format(t,e)}}function Js(t,e,i){let s,n,o,a;for(s=0,n=t.length;s<n;s++){o=t[s],a=o.getProps(["x","y","active"]),e(o,s,a),i(a,s)}}function Qs(t,e){return t.native?{x:t.x,y:t.y}:St(t,e)}function tn(t,e){const{x:i,y:s,width:n,height:o}=t;return{x:i+n/2,y:s+o/2}}function en(t,e,i){const{x:s,y:n}=e,o=Math.cos(i),a=Math.sin(i),r=t.x,l=t.y;return{x:r+o*(s-r)-a*(n-l),y:l+a*(s-r)+o*(n-l)}}function sn(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function nn(t,e,i,s){const n=t.getSortedVisibleDatasetMetas();let o=i(e);for(let t=0,i=n.length;t<i;++t){const{index:i,data:a}=n[t];for(let t=0,n=a.length;t<n;++t){const n=a[t];s(n,i,t)&&(o=n)}}return o}function on(t,e,i,s){return nn(t,e,i,s)}function an(t){const e=t.chartArea;return{x:e.left,y:e.top,x2:e.right,y2:e.bottom}}function rn(t,e){const i=t.options.scales,s={};for(const n in i)s[n]=_(i[n],e);return s}function ln(t,e){const i=t.options.plugins,s={};for(const n in i)s[n]=_(i[n],e);return s}function hn(t,e,i,s,n){const o=t.canvas,a=o.getBoundingClientRect(),r=a.width/o.width,l=a.height/o.height;let h=Math.floor(e*r),c=Math.floor(i*l);return s&&(h=Math.min(h,s.x)),n&&(c=Math.min(c,n.y)),{x:h,y:c}}function cn(t,e,i){const s=t.options.scales[e]||{};return s.adapters?s.adapters[i]:void 0}function dn(t,e){return cn(t,"time",e)}function un(t,e,i){return t.scales[e]?t.scales[e].getLabelForValue(i):i}function fn(t,e,i,s,n){const o=t.getSortedVisibleDatasetMetas();let a=i(e);for(let t=0,i=o.length;t<i;++t){const{index:i,data:r}=o[t];for(let t=0,o=r.length;t<o;++t){const o=r[t];s(o,i,t)&&(a=n(o,a))}}return a}function gn(t,e,i,s){return fn(t,e,i,((t,e,i)=>!t.skip),s)}function pn(t,e,i,s){return fn(t,e,i,(t=>!t.skip),s)}function mn(t,e){const i=t.getDatasetMeta(e).data,s=i.length;let n=0;for(;n<s;++n)i[n].x=n;return i}function bn(t,e){const i=t.data.labels,s=i.length;let n,o,a,r=[];for(n=0;n<s;n++)r.push({x:n,y:e[n]});for(n=0,o=t.getSortedVisibleDatasetMetas().length;n<o;n++){const e=t.getDatasetMeta(n).data;for(a=0;a<s;a++)e[a].x=r[a].x,e[a].y=r[a].y}}function xn(t,e,i,s){const n=t.getDatasetMeta(e).data,o=n.length;let a,r;for(a=0;a<o;a++)r=n[a],r.hidden=isNaN(t.data.datasets[e].data[a])||i,r.skip=s(r,a,n)}function _n(t){const e=t.options.plugins.legend.labels.generateLabels(t);return e.length?e[0].text:""}const yn={id:"__dummy__",defaults:{},start:function(t,e,i){t.dummy=new class{constructor(t){this.chart=t}update(){}}({chart:t})},stop:function(t){t.dummy.destroy()}};class vn{constructor(t){this.chart=t,this.options=t.options,this.ctx=t.ctx,this.scales={},this.attached=!1}init(t){const e=this.options.scales;this.scales=rn(t,e)}update(t,e){const i=this.scales,s=Object.keys(i);for(let n=0;n<s.length;n++)i[s[n]].update(t,e)}buildLabels(){const t=this.scales,e=Object.keys(t);for(let i=0;i<e.length;i++)t[e[i]].buildLabels()}fit(){let t,e,i,s=0,n=0,o=0,a=0;const r=this.scales,l=Object.keys(r);for(t=0,e=l.length;t<e;++t){const e=r[l[t]];if(e.isHorizontal()){const t=e.update(this.chart.width,this.chart.height);s+=t.width,o=Math.max(o,t.height)}else{const t=e.update(this.chart.width,this.chart.height);n+=t.width,a=Math.max(a,t.height)}}return i={width:s,height:n,paddingTop:a,paddingBottom:o},this.margins=i,i}draw(t){const e=this.scales,i=Object.keys(e);for(let s=0;s<i.length;s++)e[i[s]].draw(t)}}class wn{constructor(){}add(t,e){const i=this.get(t);i?i.add(e):this.set(t,[e])}remove(t,e){const i=this.get(t);if(i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}get(t){return this._items.get(t)}set(t,e){this._items.set(t,e)}_items=new Map}var Mn={defaults:{}};class kn{constructor(t){this.chart=t,this.options=t.options,this.ctx=t.ctx,this._animations=void 0,this._hidden=void 0,this.scales=new vn({chart:t,options:t.options.scales}),this.scale=void 0,this.stack=void 0,this.stacks=new wn,this.clip=void 0}initialize(){const t=this;t.options=t.chart.options,t.scale=t.scales.getScale(t.options.scales.x),t.scales.init(t.chart.data.datasets),t.clip=mt(t.options)}update(t,e){const i=this;i.scales.update(t,e),i.clip=mt(i.options)}draw(){const t=this.ctx,e=this.chart.chartArea;t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip(),this.drawDatasets(t),t.restore()}drawDatasets(t){const e=this.chart.getSortedVisibleDatasetMetas();for(let i=0;i<e.length;i++)this.drawDataset(e[i],t)}drawDataset(t,e){const i=this.chart.getDatasetMeta(t.index),s=i.controller;s&&s.draw(e)}getLabels(){return this.chart.data.labels}getMinMax(t,e){const i=this.chart.scales,s=Object.keys(i);let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let a=0;a<s.length;a++){const s=i[a];if(s.axis===t.axis){const t=s.getMinMax(e);n=Math.min(n,t.min),o=Math.max(o,t.max)}}return{min:n,max:o}}getStyle(t,e){const i=this.chart.getDatasetMeta(this.index);return this.chart.options.elements[i.type].color}}class Sn extends kn{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{x:{type:"category"},y:{type:"linear"}}}draw(t){const e=this.chart.getDatasetMeta(this.index),i=e.dataset,s=e.data||[],n=t.canvas.width,o=t.canvas.height;i.active&&i.draw(t,s,0,s.length,n,o)}}class Pn extends kn{static id="bar";static defaults={datasetElementType:"bar",dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,stacked:!1};static overrides={scales:{x:{type:"category",grid:{offset:!0,drawBorder:!1},ticks:{maxRotation:0,autoSkip:!0}},y:{type:"linear",beginAtZero:!0}}}getStackIndex(t,e){return this.chart.getDatasetMeta(e).stack}getStackCount(){return this.chart.data.datasets.length}getBarCount(){return this.chart.data.labels.length}getBarIndex(t){return this.chart.getDatasetMeta(t).index}getBarValue(t,e){return this.chart.data.datasets[t].data[e]}getMinMax(t,e){const i=this.chart.scales,s=Object.keys(i);let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(let a=0;a<s.length;a++){const s=i[a];if(s.axis===t.axis){const t=s.getMinMax(e);n=Math.min(n,t.min),o=Math.max(o,t.max)}}return{min:n,max:o}}}class Dn extends kn{static id="pie";static defaults={datasetElementType:"arc",dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},circumference:360,rotation:0,radius:"100%",cutout:"0%"};static overrides={plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const i=t.options.plugins.legend.labels.pointStyle;return e.labels.map(((s,n)=>{const o=t.getDatasetMeta(0).controller.getStyle(n);return{text:s,fillStyle:o.backgroundColor,strokeStyle:o.borderColor,lineWidth:o.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(n),index:n}}))}},onClick:function(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}},tooltip:{callbacks:{title:()=>"",label:t=>{let e=t.label;const i=" "+t.formattedValue;return e&&(e+=i),e}}}}}}class Cn extends kn{static id="doughnut";static defaults=Dn.defaults;static overrides=Dn.overrides;static descriptors={_scriptable:t=>"circumference"!==t&&"rotation"!==t}}class On extends kn{static id="polarArea";static defaults={datasetElementType:"arc",dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},startAngle:0,aspectRatio:1};static overrides={scales:{r:{type:"radialLinear",angleLines:{display:!1},grid:{circular:!0},pointLabels:{display:!1},ticks:{z:1}}}}}class An extends kn{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",aspectRatio:1,showLine:!0,spanGaps:!1};static overrides={scales:{r:{type:"radialLinear"}}}}class Tn extends kn{static id="scatter";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!1,fill:!1};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}}}class Ln extends kn{static id="bubble";static defaults={datasetElementType:"point",dataElementType:"point"};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}},plugins:{tooltip:{callbacks:{label:t=>t.dataset.label+": ("+t.formattedValue+", "+t.raw.r+")"}}}}}var En={bar:Pn,bubble:Ln,doughnut:Cn,line:Sn,pie:Dn,polarArea:On,radar:An,scatter:Tn};function Rn(t,e,i,s){const n=t.getSortedVisibleDatasetMetas();let o=i(e);for(let t=0,i=n.length;t<i;++t){const{index:i,data:a}=n[t];for(let t=0,n=a.length;t<n;++t){const n=a[t];s(n,i,t)&&(o=n)}}return o}function In(t,e,i,s){return Rn(t,e,i,s)}function zn(t,e,i,s){return function(n,o,a){return n[t]===e[t]?n[i]===e[i]?0:n[i]<e[i]?-1:1:s?n[t]<e[t]?-1:1:n[t]>e[t]?-1:1}}function Fn(t,e,i,s){const n=zn(t,e,i,s);return function(t,e){return n(t,e)}}function Vn(t,e,i){return Fn(t,e,i,!0)}function Bn(t,e){const i=t.getDatasetMeta(e).data,s=i.length;let n=0;for(;n<s;++n)i[n].x=n;return i}function Wn(t,e){const i=t.data.labels,s=i.length;let n,o,a,r=[];for(n=0;n<s;n++)r.push({x:n,y:e[n]});for(n=0,o=t.getSortedVisibleDatasetMetas().length;n<o;n++){const e=t.getDatasetMeta(n).data;for(a=0;a<s;a++)e[a].x=r[a].x,e[a].y=r[a].y}}function Nn(t,e,i,s){const n=t.getDatasetMeta(e).data,o=n.length;let a,r;for(a=0;a<o;a++)r=n[a],r.hidden=isNaN(t.data.datasets[e].data[a])||i,r.skip=s(r,a,n)}function Hn(t){const e=t.options.plugins.legend.labels.generateLabels(t);return e.length?e[0].text:""}const jn={id:"__element__",defaults:{},afterEvent(t,e){const i=t.element;i&&i.handleEvent(e.event)}};var $n={id:"plugin-filler",afterDatasetsUpdate(t,e,i){const s=t.data.datasets,n=s.length,o=t.options.plugins.filler;let a;for(let r=0;r<n;r++){const n=s[r],l=t.getDatasetMeta(r),h=l.controller,c=h.options,d=c.fill;if(d){const s=o.propagate?h.getMinMax(l,c.stacked):null,c=h.getFillOrigin(d);c&&h.addFill(c,s)}}}};const Un={id:"plugin-legend",_element:he,start(t,e,i){const s=t.legend=new he({ctx:t.ctx,options:i,chart:t});he.defaults.labels.generateLabels=ce,de.defaults.color=he.defaults.labels.color,i.display&&s.update(t.chartArea.width,t.chartArea.height,t.margins)},stop(t){t.legend.destroy()},beforeUpdate(t,e,i){i.display&&t.legend.update(t.chartArea.width,t.chartArea.height,t.margins)},afterUpdate(t,e,i){i.display&&t.legend.draw()},afterEvent(t,e){const i=t.legend,s=e.options,n=s.events,o=s.display;if(o&&n&&n.includes(e.event.type))return i.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullWidth:!0,reverse:!1,onHover:null,onLeave:null,onClick:function(t,e,i){const s=e.datasetIndex;const n=i.chart;n.isDatasetVisible(s)?(n.hide(s),e.hidden=!0):(n.show(s),e.hidden=!1)},labels:{color:"black",boxWidth:40,boxHeight:void 0,padding:10,generateLabels:function(t){const e=t.data.datasets,i=t.options.plugins.legend||{},s=i.labels&&i.labels.usePointStyle,n=i.labels&&i.labels.pointStyle,o=i.labels&&i.labels.textAlign,a=i.labels&&i.labels.color;return t._getSortedDatasetMetas().map((i=>{const r=i.controller.getStyle(s?0:void 0),l=y(r.borderWidth);return{text:e[i.index].label,fillStyle:r.backgroundColor,hidden:!i.visible,lineCap:r.borderCapStyle,lineDash:r.borderDash,lineDashOffset:r.borderDashOffset,lineJoin:r.borderJoinStyle,lineWidth:l,strokeStyle:r.borderColor,pointStyle:n||r.pointStyle,rotation:r.rotation,textAlign:o||r.textAlign,datasetIndex:i.index}}),this)},title:{color:"black",display:!1,position:"center",text:""}}};const Yn={id:"plugin-title",_element:de,start(t,e,i){const s=t.title=new de({ctx:t.ctx,options:i,chart:t});de.defaults.color=i.color,i.display&&s.update(t.width,t.height)},stop(t){t.title.destroy()},beforeUpdate(t,e,i){i.display&&t.title.update(t.width,t.height)},afterUpdate(t,e,i){i.display&&t.title.draw()},defaults:{align:"center",display:!1,font:{weight:"bold"},fullWidth:!0,padding:10,position:"top",text:"",color:"black"}};const Xn={id:"plugin-tooltip",_element:ue,start(t,e,i){const s=t.tooltip=new ue({ctx:t.ctx,options:i,chart:t});ue.defaults.position=fe,ue.defaults.callbacks.labelColor=function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},ue.defaults.callbacks.labelPointStyle=function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}}},stop(t){t.tooltip.destroy()},beforeUpdate(t,e,i){i.enabled&&t.tooltip.initialize(i)},afterUpdate(t,e,i){i.enabled&&t.tooltip.update(e.tooltip)},afterEvent(t,e){const i=t.tooltip,s=e.options,n=s.events,o=s.enabled;if(o&&n&&n.includes(e.event.type))return i.handleEvent(e.event,e.replay)},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleFont:{weight:"bold"},titleColor:"#fff",titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,multiKeyBackground:"#fff",displayColors:!0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:{beforeTitle:t=>t.title,title:t=>t.title,afterTitle:()=>[],beforeBody:()=>[],body:t=>t.body,afterBody:()=>[],beforeFooter:()=>[],footer:t=>t.footer,afterFooter:()=>[],label:function(t){const e=t.dataset.label||"",i=t.formattedValue;let s=e;return s&&(s+=": "),s+=i,s},labelColor:function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor:()=>"#fff",labelPointStyle:function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}}}}};class qn{constructor(t){this.id=t}install(t){t.plugins.register(this)}start(t,e,i){t.plugins.start(t,e,i)}stop(t){t.plugins.stop(t)}destroy(t){t.plugins.destroy(t)}}var Zn=Object.freeze({__proto__:null,Element:jn,Filler:$n,Legend:Un,Title:Yn,Tooltip:Xn});class Gn extends qs{constructor(t){super("colors","plugin"),this.options=t||{}}beforeLayout(t){const e=t.options.plugins.colors;e&&e.enabled&&this.colorize(t)}}const Kn=new Gn;class Jn extends qs{constructor(t){super("decimation","plugin"),this.options=t||{}}beforeElementsUpdate(t){this.options.enabled&&this.decimate(t)}decimate(t){const e=t.data.datasets;let i,s;for(i=0,s=e.length;i<s;++i){const s=e[i],n=t.getDatasetMeta(i);n.controller.getMinMax(n,s.stacked);const o=n.data;if(o.length>this.options.threshold){const t=function(t,e){const i=t.length;let s,n=0;return t.forEach(((t,o)=>{s=Math.floor(o/e),s>n&&(t.visible=!1,t.data[o-1].visible=!0),n=s})),t}(o,this.options.threshold);n.data=t}}}}const Qn=new Jn;class tn extends qs{constructor(t){super("filler","plugin"),this.options=t||{}}afterDatasetsUpdate(t,e,i){const s=t.data.datasets,n=s.length,o=t.options.plugins.filler;let a;for(let r=0;r<n;r++){const n=s[r],l=t.getDatasetMeta(r),h=l.controller,c=h.options,d=c.fill;if(d){const s=o.propagate?h.getMinMax(l,c.stacked):null,c=h.getFillOrigin(d);c&&h.addFill(c,s)}}}}const en=new tn;class sn extends qs{constructor(t){super("legend","plugin"),this.options=t||{},this._element=he,this.legend=void 0,he.defaults.labels.generateLabels=ce,de.defaults.color=he.defaults.labels.color}start(t,e,i){const s=this.legend=new he({ctx:t.ctx,options:i,chart:t});i.display&&s.update(t.chartArea.width,t.chartArea.height,t.margins)}stop(){this.legend.destroy()}beforeUpdate(t,e,i){i.display&&this.legend.update(t.chartArea.width,t.chartArea.height,t.margins)}afterUpdate(t,e,i){i.display&&this.legend.draw()}afterEvent(t){const e=this.legend,i=t.options,s=i.events,n=i.display;if(n&&s&&s.includes(t.event.type))return e.handleEvent(t.event)}}const nn=new sn;class on extends qs{constructor(t){super("title","plugin"),this.options=t||{},this._element=de,this.title=void 0,de.defaults.color=this.options.color}start(t,e,i){const s=this.title=new de({ctx:t.ctx,options:i,chart:t});i.display&&s.update(t.width,t.height)}stop(){this.title.destroy()}beforeUpdate(t,e,i){i.display&&this.title.update(t.width,t.height)}afterUpdate(t,e,i){i.display&&this.title.draw()}}const an=new on;class rn extends qs{constructor(t){super("tooltip","plugin"),this.options=t||{},this._element=ue,this.tooltip=void 0,ue.defaults.position=fe,ue.defaults.callbacks.labelColor=function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},ue.defaults.callbacks.labelPointStyle=function(t){const e=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}}}start(t,e,i){const s=this.tooltip=new ue({ctx:t.ctx,options:i,chart:t});i.enabled&&s.initialize(i)}stop(){this.tooltip.destroy()}beforeUpdate(t,e,i){i.enabled&&this.tooltip.initialize(i)}afterUpdate(t,e,i){i.enabled&&this.tooltip.update(e.tooltip)}afterEvent(t){const e=this.tooltip,i=t.options,s=i.events,n=i.enabled;if(n&&s&&s.includes(t.event.type))return e.handleEvent(t.event,t.replay)}}const ln=new rn;var hn=Object.freeze({__proto__:null,Colors:Kn,Decimation:Qn,Filler:en,Legend:nn,Title:an,Tooltip:ln});class cn extends qs{constructor(t){super("category","scale"),this.options=t||{},this._labels=[],this._sortedLabels=[]}parse(t,e){const i=this._labels;if(void 0!==i[t])return t;const s=i.indexOf(t);return-1===s?this.options.labels.indexOf(t):s}getLabelForValue(t){return this._labels[t]}buildLabels(){const t=this.options.labels||[];this._labels=t,this._sortedLabels=t.slice().sort()}getPixelForValue(t){return this.left+this.width*(t/this._labels.length)}getValueForPixel(t){const e=Math.round((t-this.left)/this.width*this._labels.length);return Math.min(e,this._labels.length-1)}}class dn extends qs{constructor(t){super("linear","scale"),this.options=t||{},this.start=void 0,this.end=void 0,this.ticks=[]}parse(t,e){return"number"!=typeof t||isNaN(t)?null:t}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=d(t)?0:t,this.max=d(e)?1:e,this.handleTickRangeOptions()}buildTicks(){const t=this.options.ticks;let e=this.ticks;if(e.length)return e;const i=this.determineStep(),s=function(t,e,i){let s,n=[],o=Math.floor(e/i),a=Math.ceil(t/i);for(s=a*i;s<=o*i;s+=i)n.push(s);return n}(this.min,this.max,i);return this.ticks=s,s}determineStep(){const t=this.options.ticks,e=t.maxTicksLimit||11;let i=t.stepSize;if(i)return i;const s=Math.max(Math.abs(this.min),Math.abs(this.max));let n=Math.pow(10,Math.floor(Math.log10(s)));const o=s/n;return o>5?n*=10:o>2?n*=5:o>1&&(n*=2),n}}class un extends qs{constructor(t){super("logarithmic","scale"),this.options=t||{},this.start=void 0,this.end=void 0,this.ticks=[]}parse(t){return"number"!=typeof t||isNaN(t)?null:t}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=d(t)?null:Math.log10(t),this.max=d(e)?null:Math.log10(e)}buildTicks(){const t=this,e=t.options.ticks,i=function(t,e){const i=[];let s,n,o;const a=e.min,r=e.max,l=e.stepSize,h=Math.floor(a/l),c=Math.ceil(r/l),d=Math.pow(10,l);for(s=h;s<=c;s++){n=Math.pow(10,s);for(let t=1;t<10;t++)o=n*t,o>=Math.pow(10,a)&&o<=Math.pow(10,r)&&i.push({value:o,major:1===t})}return i}(t,t);return t.ticks=i,i}getPixelForValue(t){return null===t?NaN:this.getPixelForDecimal((Math.log10(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}class fn extends qs{constructor(t){super("radialLinear","scale"),this.options=t||{},this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this.ticks=[]}setDimensions(){this.xCenter=this.chart.width/2,this.yCenter=this.chart.height/2,this.drawingArea=Math.min(this.chart.width,this.chart.height)/2}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=d(t)?0:t,this.max=d(e)?0:e}buildTicks(){const t=this.options.ticks,e=this.min,i=this.max,s=t.stepSize||(i-e)/t.maxTicksLimit,n=[];let o=e;for(;o<=i;)n.push({value:o,label:t.callback(o)}),o+=s;return this.ticks=n,n}getPixelForValue(t){const e=this.drawingArea/(this.max-this.min);return(t-this.min)*e}getPointPosition(t,e,i){const s=this.drawingArea/(this.max-this.min);return{x:this.xCenter+Math.cos(e)*(t-this.min)*s,y:this.yCenter+Math.sin(e)*(t-this.min)*s,angle:e}}}class gn extends qs{constructor(t){super("time","scale"),this.options=t||{},this._adapter=new Ks({options:this.options}),this._cache={min:null,max:null},this._major=void 0,this._unit=void 0,this._offsets=void 0,this._table=void 0,this._minPos=void 0,this._maxPos=void 0}init(t){const e=this.options;this._adapter=new Ks({options:e}),super.init(t)}parse(t,e){return this._adapter.parse(t)}format(t,e){return this._adapter.format(t,e)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=d(t)?null:this._adapter.parse(t),this.max=d(e)?null:this._adapter.parse(e)}buildTicks(){const t=this,e=t.options.ticks,i=t._adapter,s=t.min,n=t.max,o=e.source,a=e.stepSize,r=e.unit,l=e.maxTicksLimit||11,h=function(t,e,i,s,n){let o,a,r,l,h=[],c=t.getTime();for(o=t;o<=e;o=i.add(o,1,s)){a=o.getTime();const t=Math.round((a-c)/864e5);if(t>=n)break;h.push({value:a,major:!1})}return h}(s,n,i,r||"day",l);return t.ticks=h,h}getPixelForValue(t){const e=this._adapter.parse(t);return null===e?NaN:this.getPixelForDecimal((e.getTime()-this._firstTick.getTime())/this._table[this._table.length-1].time)}getValueForPixel(t){const e=this._firstTick.getTime()+t/this.width*(this._table[this._table.length-1].time-this._firstTick.getTime());return this._adapter.format(e)}}class pn extends qs{constructor(t){super("timeseries","scale"),this.options=t||{},this._adapter=new Ks({options:this.options}),this._cache={min:null,max:null},this._major=void 0,this._unit=void 0,this._offsets=void 0,this._table=void 0,this._minPos=void 0,this._maxPos=void 0}init(t){const e=this.options;this._adapter=new Ks({options:e}),super.init(t)}parse(t,e){return this._adapter.parse(t)}format(t,e){return this._adapter.format(t,e)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=d(t)?null:this._adapter.parse(t),this.max=d(e)?null:this._adapter.parse(e)}buildTicks(){const t=this,e=t.options.ticks,i=t._adapter,s=t.min,n=t.max,o=e.source,a=e.stepSize,r=e.unit,l=e.maxTicksLimit||11,h=function(t,e,i,s,n){let o,a,r,l,h=[],c=t.getTime();for(o=t;o<=e;o=i.add(o,1,s)){a=o.getTime();const t=Math.round((a-c)/864e5);if(t>=n)break;h.push({value:a,major:!1})}return h}(s,n,i,r||"day",l);return t.ticks=h,h}getPixelForValue(t){const e=this._adapter.parse(t);return null===e?NaN:this.getPixelForDecimal((e.getTime()-this._firstTick.getTime())/this._table[this._table.length-1].time)}getValueForPixel(t){const e=this._firstTick.getTime()+t/this.width*(this._table[this._table.length-1].time-this._firstTick.getTime());return this._adapter.format(e)}}var mn=Object.freeze({__proto__:null,CategoryScale:cn,LinearScale:dn,LogarithmicScale:un,RadialLinearScale:fn,TimeScale:gn,TimeSeriesScale:pn});class bn{constructor(t,e,i,s,n){this.id=t,this.type=e,this.options=void 0,this.chart=s,this.ctx=i,this.ticks=[],this.tick_values=[],this.label_values=[],this.label_lookup=void 0,this.min=void 0,this.max=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.margins={left:0,right:0,top:0,bottom:0},this.labelRotation=0,this.labelOffset=0,this.grid=void 0,this.border=void 0,this.paddingTop=0,this.paddingBottom=0,this.paddingLeft=0,this.paddingRight=0,this.longestTextCache={},this._pointLabels=[],this.init(n)}init(t){const e=this;e.options=t,e.id=t.id,e.type=t.type,e.axis=t.axis,e.ticks=new(e.options.ticks.type||dn)({scale:e,options:e.options.ticks}),e.grid=new(e.options.grid.type||i)({scale:e,options:e.options.grid}),e.border=new(e.options.border.type||s)({scale:e,options:e.options.border}),e.title=new(e.options.title.type||n)({scale:e,options:e.options.title})}update(t,e){const i=this,s=i.options;i.width=t,i.height=e,i.top=i.chart.chartArea.top,i.bottom=i.chart.chartArea.bottom,i.left=i.chart.chartArea.left,i.right=i.chart.chartArea.right,i.ticks.update(t,e),i.grid.update(t,e),i.border.update(t,e),i.title.update(t,e),i.labelRotation=s.ticks.labelRotation,i.labelOffset=s.ticks.labelOffset,i.margins=Object.assign({left:0,right:0,top:0,bottom:0},s.margins),i.paddingTop=s.padding.top,i.paddingBottom=s.padding.bottom,i.paddingLeft=s.padding.left,i.paddingRight=s.padding.right}buildLabels(){const t=this.ticks.buildLabels();this.ticks.values=t,this.ticks.labels=t.map((t=>t.label))}fit(){const t=this,e={width:0,height:0},i=t.options,s=i.ticks,n=i.title,o=i.grid;if(t.isHorizontal()){const i=t.ticks.fit();e.width=i.width,e.height=Math.max(i.height,o.lineWidth,n.font.size)}else{const i=t.ticks.fit();e.height=i.height,e.width=Math.max(i.width,o.lineWidth,n.font.size)}return t.margins=Object.assign(t.margins,e),e}draw(t){this.grid.draw(t),this.border.draw(t),this.ticks.draw(t),this.title.draw(t)}getPixelForValue(t){return this.ticks.getPixelForValue(t)}getValueForPixel(t){return this.ticks.getValueForPixel(t)}getLabelForValue(t){return this.ticks.getLabelForValue(t)}getMinMax(t){const e=this.ticks.getMinMax(t);return{min:e.min,max:e.max}}isHorizontal(){return"x"===this.axis}}class xn extends bn{static id="category";static defaults={ticks:{type:cn}}}class _n extends bn{static id="linear";static defaults={ticks:{type:dn}}}class yn extends bn{static id="logarithmic";static defaults={ticks:{type:un}}}class vn extends bn{static id="radialLinear";static defaults={ticks:{type:fn}}}class wn extends bn{static id="time";static defaults={ticks:{type:gn}}}class Mn extends bn{static id="timeseries";static defaults={ticks:{type:pn}}}var kn=Object.freeze({__proto__:null,CategoryScale:xn,LinearScale:_n,LogarithmicScale:yn,RadialLinearScale:vn,TimeScale:wn,TimeSeriesScale:Mn});return t.Animation=Us,t.Animations=Ys,t.Chart=class{constructor(t,e){const i=this.config=e,s=n(t,i.type);this.canvas=s,this.ctx=s.getContext("2d"),this.width=s.width,this.height=s.height,this.aspectRatio=s.width/s.height,this.attached=!1,this.active=[],this.id=Math.random().toString(36).substr(2,9),this.options=void 0,this.scales=void 0,this.tooltip=void 0,this.plugins=void 0,this._sortedMetasets=void 0,this._metasets=[],this._listeners={},this._sortedDatasets=[],this._animationsDisabled=!1,this.platform=this._initializePlatform(),this._initialize(),this.update()}_initialize(){const t=this;t.options=t.config.options||{},t.options.devicePixelRatio=t.options.devicePixelRatio||t.platform.getDevicePixelRatio(),t.plugins=new class{constructor(){this._plugins=new Map,this._sorted=null}register(...t){const e=this;for(const i of t)e._plugins.set(i.id,i);return e}unregister(...t){const e=this;for(const i of t)e._plugins.delete(i.id);return e}start(t,e,i){const s=this;for(const[n,o]of s._plugins.entries())o.start(t,e,i)}stop(t){const e=this;for(const[i,s]of e._plugins.entries())s.stop(t)}destroy(t){const e=this;for(const[i,s]of e._plugins.entries())s.destroy(t)}};const e=t.options.plugins;Object.keys(e).forEach((i=>{const s=e[i];!1!==s&&t.plugins.register(new(Hi[i])(s))})),t.scales=new vn({chart:t,options:t.options.scales}),t.tooltip=new ue({chart:t,options:t.options.plugins.tooltip}),t.legend=new he({chart:t,options:t.options.plugins.legend}),t.title=new de({chart:t,options:t.options.plugins.title}),Object.values(En).forEach((e=>t.register(e))),t.data=t.config.data,t.data.datasets.forEach(((e,i)=>{e.index=i}))}_initializePlatform(){return new(t.platforms.get(this.config.type)||t.platforms.get("basic"))}update(t){const e=this;e.options.responsive&&e.resize(),e.options=e.config.options,e.scales.update(e.width,e.height),e.tooltip.update(),e.legend.update(e.chartArea.width,e.chartArea.height,e.margins),e.title.update(e.width,e.height);const i=e.data.datasets;i.forEach(((t,i)=>{e._getDatasetMeta(i).controller.update(t,i)})),e.render()}_getDatasetMeta(t){const e=this._metasets;let i=e[t];return i||(i=e[t]={type:this.data.datasets[t].type,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,stack:null,index:t}),i}_getSortedDatasetMetas(t){const e=this._metasets,i=e.slice(0);return t&&i.sort(((t,e)=>t.index-e.index)),i}getSortedVisibleDatasetMetas(){return this._sortedMetasets.filter((t=>!t.hidden))}getDatasetMeta(t){return this._metasets[t]}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){return!this._metasets[t].hidden}setDatasetVisibility(t,e){this._metasets[t].hidden=!e}toggleDataVisibility(t){this._metasets[t].hidden=!this._metasets[t].hidden}getDataVisibility(t){return!this._metasets[t].hidden}hide(t){this._metasets[t].hidden=!0}show(t){this._metasets[t].hidden=!1}getActiveElements(){return this.active}setActiveElements(t){this.active=t.map((({datasetIndex:t,index:e})=>{const i=this.getDatasetMeta(t);return{datasetIndex:t,index:e,element:i.data[e]}}))}getElementsAtEventForMode(t,e,i,s){const n=fe[e];return n?n(this.getSortedVisibleDatasetMetas(),t,i,s):[]}getDatasetAtEvent(t){return this.getElementsAtEventForMode(t,"dataset",{intersect:!0})[0]}getElementsAtEvent(t){return this.getElementsAtEventForMode(t,"point",{intersect:!0})}getElementAtEvent(t){return this.getElementsAtEventForMode(t,"nearest",{intersect:!0})[0]}destroy(){const t=this;t.stop(),t.canvas.remove(),delete t.canvas,delete t.ctx,delete t.chart,delete t.options,delete t.scales,delete t.tooltip,delete t.plugins,delete t.legend,delete t.title,delete t.data,delete t._sortedMetasets,delete t._metasets,delete t._listeners,delete t.platform}toBase64Image(...t){return this.canvas.toDataURL(...t)}render(){const t=this;t.ctx.clearRect(0,0,t.width,t.height),t.plugins.notify("beforeRender",t),t.scales.draw(t.ctx),t.plugins.notify("beforeDraw",t);const e=t.getSortedVisibleDatasetMetas();for(let i=0;i<e.length;i++)t.drawDataset(e[i]);t.plugins.notify("afterDraw",t),t.tooltip.draw(t.ctx),t.legend.draw(t.ctx),t.title.draw(t.ctx),t.plugins.notify("afterRender",t)}drawDataset(t){const e=this.ctx,i=t.controller;i&&i.draw(e)}stop(){Us.stop(this),this.platform.releaseContext(this.ctx)}resize(t,e,i){const s=this,n=s.options,o=s.canvas,a=n.maintainAspectRatio&&s.aspectRatio,r=s.platform.getMaximumSize(o,t,e,a),l=n.devicePixelRatio||1;s.width=r.width,s.height=r.height,s.aspectRatio=s.width/s.height,s.ctx.setTransform(l,0,0,l,0,0),s.attached&&s.notifyPlugins("resize",{size:r})}reset(){this.update({update:!1})}clear(){this.ctx.clearRect(0,0,this.width,this.height)}notifyPlugins(t,e){const i=this.plugins;for(const s in i)i[s][t]&&i[s][t](this,e)}},t.DatasetController=kn,t.Element=class{constructor(){this.x=void 0,this.y=void 0,this.active=!1,this.options=void 0,this.$animations=void 0}tooltipPosition(t){return this.getCenterPoint(t)}hasValue(){return this.x>=0&&this.y>=0}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach((t=>{s[t]=i[t]&&i[t].active()?i[t].current():this[t]})),s}},t.Interaction=fe,t.Scale=bn,t.Ticks=class{constructor({ctx:t,options:e,chart:i,scale:s}){this.options=e,this.chart=i,this.scale=s,this.ctx=t,this.ticks=[],this.labels=[],this._cache={}}buildLabels(){const t=this.options.callback;this.labels=this.ticks.map((e=>t(e.value,e.index,this.ticks)))}calculateLabelRotation(){const t=this.options,e=t.maxRotation,i=t.minRotation;let s=t.labelRotation;if(!s)return;const n=this.chart.options.maintainAspectRatio,o=n&&this.scale.width/this.scale.height;if(!n||o<1)return;const a=Math.PI/180*s;let r=Math.cos(a),l=Math.sin(a);const h=this.chart.width,c=this.chart.height,d=this.scale.getLabels(),u=d.map((t=>this.ctx.measureText(t).width)),f=u.reduce(((t,e)=>Math.max(t,e)),0);let g=Math.ceil(f/Math.abs(r));g>h/2&&(g=h/2);let p=Math.ceil(f/Math.abs(l));p>c&&(p=c);const m=Math.min(g,p);this.labelRotation=Math.asin(f/m)*ss}fit(){const t=this,e={width:0,height:0},i=t.options.ticks,s=t.chart.options.maintainAspectRatio,n=s&&t.scale.width/t.scale.height;if(t.scale.isHorizontal()){const s=t.calculateLabelRotation();t.labelRotation=s;const o=Math.cos(s*qe),a=Math.sin(s*qe),r=t.getLabels().map((e=>t.ctx.measureText(e).width)),l=r.reduce(((t,e)=>Math.max(t,e)),0);e.width=l*o+i.font.size*a,e.height=l*a+i.font.size*o}else e.width=i.font.size,e.height=t.getLabels().length*i.font.size;return n&&!t.scale.isHorizontal()&&(e.width=Math.min(e.width,t.scale.width)),e}draw(t){const e=this.options,i=this.ticks,s=e.color,n=this.ctx;n.save(),n.fillStyle=s;for(const s of i)n.fillText(s.label,s.x,s.y),e.showLabelBackdrop&&n.fillRect(s.backdropX,s.backdropY,s.backdropWidth,s.backdropHeight);n.restore()}},t._adapters=Ks,t.defaults=c,t.platforms=new class{constructor(){this._platforms=new Map}register(t){this._platforms.set(t.id,t)}get(t){return this._platforms.get(t)}},t.register=function(...t){const e=[];for(const i of t)e.push(...Object.values(i));const i=t.map((t=>Object.keys(t).map((e=>t[e]))));for(const t of i)for(const i of t)d(i.id)||d(i.defaults)||c.plugins.register(i)},t.registry={controllers:En,elements:{},plugins:Hi,scales:kn},e=t,t=e=>{Object.assign(c,e)},e(Mn),e(xn),e(yn),e(_n),e(vn),e(wn),e(Sn.defaults),e(Pn.defaults),e(Dn.defaults),e(Cn.defaults),e(On.defaults),e(An.defaults),e(Tn.defaults),e(Ln.defaults),Object.assign(c.elements,{arc:{backgroundColor:"rgba(0, 0, 0, 0.1)",borderColor:"#fff",borderWidth:2},bar:{backgroundColor:"rgba(0, 0, 0, 0.1)",borderColor:"rgba(0, 0, 0, 0.1)",borderWidth:0,borderRadius:0,borderSkipped:"start"},line:{borderColor:"rgba(0, 0, 0, 0.1)",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,tension:0},point:{backgroundColor:"rgba(0, 0, 0, 0.1)",borderColor:"rgba(0, 0, 0, 0.1)",borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}}),c.set("plugins",{decimation:Fi.defaults,filler:ae.defaults,legend:Bi.defaults,title:Wi.defaults,tooltip:Ni.defaults}),t.register(En,kn,{},Hi),t.helpers=me,t._adapters=Ks,t.Animation=Us,t.Animations=Ys,t.controllers=En,t.elements={},t.layouts={},t.platforms=t.platforms,t.plugins=Hi,t.scales=kn,t.helpers=Object.assign({},me,me),t}));
    </script>

    <nav class="navbar">
        <a href="/" class="brand">{{ station_name }}</a>
        <div>
            <a href="{{ url_for('dashboard') }}" class="active">Dashboard</a>
            <a href="{{ url_for('settings') }}">Settings</a>
        </div>
    </nav>

    <div class="container">
        <div class="tab-nav">
            {% for tab in station_tabs %}
            <button class="tab-button" onclick="openTab(event, 'station-{{ tab.id }}')" {% if loop.first %}id="defaultOpen"{% endif %}>
                {{ tab.name }}
            </button>
            {% endfor %}
        </div>

        {% for tab in station_tabs %}
        <div id="station-{{ tab.id }}" class="tab-content">
            <h1>Live Readings</h1>
            <div class="sensor-grid">
                {% if tab.data %}
                    {% for key, reading in tab.data.items() %}
                    <div class="sensor-box">
                        <span class="value">{{ '%.2f'|format(reading.value) }}<span class="unit">{{ reading.unit }}</span></span>
                        <span class="label">{{ reading.label }}</span>
                        <span class="timestamp">Updated: {{ reading.timestamp | replace("T", " ") | slice(0, 19) }} UTC</span>
                        {% if reading.rssi %}
                            <span class="badge">RSSI: {{ reading.rssi }}</span>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <p>No data received yet for this station.</p>
                {% endif %}
            </div>

            <div class="charts-section">
                <h1>Historical Data</h1>
                <div class="time-range-selector">
                    <button onclick="updateCharts({{ tab.id }}, 24, this)" class="active">24 Hours</button>
                    <button onclick="updateCharts({{ tab.id }}, 168, this)">7 Days</button>
                    <button onclick="updateCharts({{ tab.id }}, 720, this)">30 Days</button>
                </div>
                <div class="charts-grid" id="charts-grid-{{ tab.id }}">
                    <!-- Charts will be generated here by JavaScript -->
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <script>
        const chartInstances = {};
        const loadedTabs = new Set(); // Keep track of which tabs have had their charts loaded

        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].style.display = "none";
            }
            const tabButtons = document.getElementsByClassName("tab-button");
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].className = tabButtons[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";

            // --- FIX: Logic to load charts when a tab is opened ---
            const stationId = parseInt(tabName.split('-')[1]);
            if (!loadedTabs.has(stationId)) {
                const timeRangeSelector = document.getElementById(tabName).querySelector('.time-range-selector');
                const defaultTimeButton = timeRangeSelector.querySelector('button.active') || timeRangeSelector.querySelector('button');
                if (defaultTimeButton) {
                    // Extract hours from the button's onclick attribute
                    const hours = defaultTimeButton.getAttribute('onclick').match(/, (\d+),/)[1];
                    updateCharts(stationId, parseInt(hours), defaultTimeButton);
                    loadedTabs.add(stationId);
                }
            }
        }

        function updateCharts(stationId, hours, btnElement) {
            // Update active button style
            if(btnElement) {
                const buttons = btnElement.parentElement.children;
                for(let i = 0; i < buttons.length; i++) {
                    buttons[i].classList.remove('active');
                }
                btnElement.classList.add('active');
            }

            fetch(`/api/historical_data?station_id=${stationId}&hours=${hours}`)
                .then(response => response.json())
                .then(data => {
                    const chartsGrid = document.getElementById(`charts-grid-${stationId}`);
                    chartsGrid.innerHTML = ''; // Clear old charts

                    // Destroy old chart instances for this station
                    if (chartInstances[stationId]) {
                        Object.values(chartInstances[stationId]).forEach(chart => chart.destroy());
                    }
                    chartInstances[stationId] = {};

                    for (const key in data) {
                        const chartData = data[key];
                        const container = document.createElement('div');
                        container.className = 'chart-container';
                        const canvas = document.createElement('canvas');
                        container.appendChild(canvas);
                        chartsGrid.appendChild(container);

                        chartInstances[stationId][key] = new Chart(canvas, {
                            type: 'bar',
                            data: {
                                labels: chartData.labels.map(ts => ts.slice(5, 16).replace('T', ' ')),
                                datasets: [{
                                    label: `${key.replace(/_/g, ' ').replace(/(^\w|\s\w)/g, m => m.toUpperCase())} (${chartData.unit})`,
                                    data: chartData.values,
                                    backgroundColor: 'rgba(0, 121, 107, 0.6)',
                                    borderColor: 'rgba(0, 121, 107, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    x: { ticks: { maxRotation: 90, minRotation: 45, autoSkip: true, maxTicksLimit: 20 } },
                                    y: { beginAtZero: true }
                                },
                                plugins: { legend: { display: true } }
                            }
                        });
                    }
                });
        }

        // Initialize default tab
        document.addEventListener('DOMContentLoaded', (event) => {
            const defaultTabButton = document.getElementById("defaultOpen");
            if (defaultTabButton) {
                defaultTabButton.click();
            }
        });
    </script>
</body>
</html>
